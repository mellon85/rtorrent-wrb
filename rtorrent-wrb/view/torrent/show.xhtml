<h3>#{@title}</h3>

<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/jquery.joverlay.min.js"></script>
<script language="javascript">
$(function(){
    $('#trackerpane').hide();
    $('#peerspane').hide();
    $('#removeBox').hide();
});

function priority_up(id,p,i) {
    $.get("/torrent/priority_up/"+id+"/"+p+"/"+i,{}
        ,function(d) {
            $("#prio"+i).text(d);
        },"text");
}

function priority_down(id,p,i) {
    $.get("/torrent/priority_down/"+id+"/"+p+"/"+i,{}
        ,function(d) {
            $("#prio"+i).text(d);
        },"text");
}
</script>

<!-- torrents -->
<?r if @current_torrent != nil then ?>
<div id="torrent">
    Torrent hash: #{@current_torrent[:torrent_id]}
</div>
<div id="removeBox">
Do you really want to remove this torrent?<br>
<center>
    <a href="/torrent/remove/#{@current_torrent[:torrent_id]}">Remove</a>
</center>
</div>
<a onclick="$('#removeBox').jOverlay({color:'red', opacity: 0.6});">Remove</a>
<div id="files">

<table border="0">
<form action="#{Rs(:set_priority)}" method="post" enctype="multipart/form-data">
  <input type="hidden" name="torrentID" value="#{@current_torrent.torrent_id}" />
  <tr></th><th><th>File Name</th><th>Size</th><th>Downloaded</th><th>Priority</th></tr>
  <?r i = 0 ?>
  <?r @current_torrent.torrentfiles.each do |x| ?>
  <tr>
     <th><input type="checkbox" name="selectedFiles[]" value="#{i}"></th>
      <th align="left">#{x[:name]}</th>
      <th align="right">#{convert_bytes(x.size)}</th>
      <th align="right">#{convert_bytes(x.downloaded)}</th>
      <th><div id="prio#{i}">#{print_priority(x.priority)}</div></th>
      <th>
<a onclick="priority_up('#{@current_torrent[:torrent_id]}',#{x.priority},#{i})">+</a>
      </th>
      <th>
<a onclick="priority_down('#{@current_torrent[:torrent_id]}',#{x.priority},#{i})">-</a>
      </th></tr>
  <?r i+=1 ?>
  <?r end ?>
</table>
<input type="submit" value="Change Priority"/>
<select name="priority">
  <option value="0">Off</option>
  <option value="1">Normal</option>
  <option value="2">Hight</option>
</select>
</form>
</div>

<div id="trackers">
    <p><b onclick="$('#trackerpane').toggle('slow')">Trackers</b><br>
<div id="trackerpane">
<?r @current_torrent.trackers.each do |x| ?>
    <?r if !(x.url =~ /dht\:/) then ?>
    #{x.url}<br>
    <?r end ?>
<?r end ?>
</div>
</p></div>


<div id="peers">
    <p><b onclick="$('#peerspane').toggle('slow')">Peers</b><br>
<div id="peerspane">
<table border="0" valign="middle">
    <tr><th>Peer</th><th>Downloading</th><th>Uploading</th>
        <th>Downloaded</th>
        <th>Uploaded</th><th>%</th>
    </tr>
<?r @peers.each do |x| ?>
<tr><th>#{x[0]}</th><th>#{convert_bytes(x[1])}</th>
    <th>#{convert_bytes(x[2])}</th>
    <th>#{convert_bytes(x[3])}</th>
    <th>#{convert_bytes(x[4])}</th><th>#{x[5]}</th>
    </tr>
<?r end ?>
</table>
</div>
</div>

<!-- Error -->
<?r else ?>
<div id="error">
    Error
</div>
<?r end ?>
<p>
<a href="/torrent">back</a>
<a href="#{Rs(:logout)}">logout</a>
</p>
